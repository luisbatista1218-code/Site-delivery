<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Delivery App Completo</title>
<style>
body {margin:0;font-family:sans-serif;background:#1b0033;color:#fff;}
.top {display:flex;justify-content:space-between;align-items:center;padding:10px;background:#2a0050;}
.top button {background:#fff;color:#2a0050;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;}
.main {padding:10px;}
.hero {width:100%;height:60vh;border-radius:8px;overflow:hidden;background:#300046;display:flex;justify-content:center;align-items:center;font-size:24px;}
.nav {position:fixed;bottom:0;left:0;right:0;background:#2a0050;padding:8px;display:flex;justify-content:space-around;}
.nav button {background:#fff;color:#2a0050;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;}
.card {background:#fff;color:#000;padding:8px;border-radius:8px;margin:8px 0;}
.card img {width:100%;height:160px;object-fit:cover;border-radius:6px;}
.card button {cursor:pointer;}
.loading {color: #fff; text-align: center; padding: 20px;}
.upload-area {border: 2px dashed #ccc; padding: 20px; text-align: center; margin: 10px 0; border-radius: 8px;}
.upload-area.active {border-color: #2a0050; background: #f0f0f0;}
.file-info {background: #e8f4fd; padding: 10px; border-radius: 5px; margin: 10px 0; color: #000;}
.btn {background: #2a0050; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;}
.btn-ghost {background: #fff; color: #2a0050; padding: 10px 15px; border: 1px solid #2a0050; border-radius: 5px; cursor: pointer; margin: 5px;}
.btn-disabled {background: #ccc; color: #666; cursor: not-allowed;}
</style>
</head>
<body>

<div class="top">
  <button onclick="goBack()">‚Üê Voltar</button>
  <button onclick="openContact()">Contato</button>
  <strong>Delivery</strong>
  <button onclick="openUser()">Usu√°rio/Admin</button>
</div>

<div class="main">
  <div id="view"></div>
</div>

<div class="nav">
  <button onclick="showHome()">In√≠cio</button>
  <button onclick="showCategories()">Categoria</button>
  <button onclick="showCart()">Carrinho</button>
  <button onclick="showNotifs()">Notifica√ß√µes</button>
</div>

<script>
// --- DADOS GLOBAIS ---
let cart = [];
let notifications = [];
let orders = [];
let currentView = 'home';
let products = [
  {id:1,categoria:"Pizza",nome:"Pizza Calabresa",descricao:"Pizza com borda de requeij√£o",preco:30.00,imagem:"pizza-calabresa.jpg"}
];

// --- FUN√á√ïES PRINCIPAIS ---
function goBack(){
  if(currentView === 'categories' || currentView === 'cart' || currentView === 'notifs' || currentView === 'admin'){
    showHome();
  }
}

function openContact(){ 
  alert("WhatsApp: (11) 99999-9999\nEmail: contato@delivery.com"); 
}

function openUser(){
  let tipo = prompt("Digite 'admin' para acessar admin, deixe vazio para usu√°rio:");
  if(tipo && tipo.toLowerCase()==='admin'){
    let email = prompt("Email:");
    let senha = prompt("Senha:");
    if(email==="admin@local" && senha==="admin123"){ 
      showAdminOrders(); 
    } else {
      alert("Credenciais inv√°lidas");
    }
  }
}

function showHome(){
  currentView = 'home';
  document.getElementById('view').innerHTML = `
    <div class='hero' style='
      background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), 
                  url("banner-inicial.jpg");
      background-size: cover; 
      background-position: center;
      color: white;
      text-align: center;
    '>
      <h2>Bem-vindo ao Delivery</h2>
      <p>Pe√ßa suas pizzas favoritas!</p>
    </div>`;
}

function showCategories(){
  currentView = 'categories';
  let html = "<h3>Categoria: Pizza</h3>";
  products.forEach(p => {
    html += `<div class='card'>
      <img src='${p.imagem}' alt='${p.nome}' onerror="this.src='https://via.placeholder.com/400x200?text=Imagem+N√£o+Encontrada'"/>
      <h4>${p.nome}</h4>
      <p>${p.descricao}</p>
      <div>
        <button onclick='addToCart(${p.id})'>Adicionar ao Carrinho</button>
        <span style='margin-left:10px; font-weight:bold'>R$ ${p.preco.toFixed(2)}</span>
      </div>
    </div>`;
  });
  document.getElementById('view').innerHTML = html;
}

function addToCart(id){
  let p = products.find(x => x.id === id);
  if (!p) return;
  
  let item = cart.find(c => c.id === id);
  if (item) {
    item.qtd++;
  } else {
    cart.push({
      id: p.id,
      nome: p.nome,
      preco: p.preco,
      qtd: 1
    });
  }
  showCart();
  alert(`${p.nome} adicionado ao carrinho!`);
}

function showCart(){
  currentView = 'cart';
  let html = '<h3>Seu Carrinho</h3>';
  
  if(cart.length === 0){ 
    html += '<p>Carrinho vazio</p>';
  } else {
    let total = 0;
    cart.forEach(item => {
      let subtotal = item.preco * item.qtd;
      total += subtotal;
      html += `<div class='card'>
        <b>${item.nome}</b>
        <div>Quantidade: 
          <button onclick='decQty(${item.id})'>-</button> 
          ${item.qtd} 
          <button onclick='incQty(${item.id})'>+</button>
        </div>
        <div>Subtotal: R$ ${subtotal.toFixed(2)}</div>
      </div>`;
    });
    
    html += `
      <div class='card'>
        <h3>Total: R$ ${total.toFixed(2)}</h3>
        <button onclick='startCheckout()' class="btn">Finalizar Pedido</button>
        <button onclick='clearCart()' class="btn-ghost">Limpar Carrinho</button>
      </div>`;
  }
  
  document.getElementById('view').innerHTML = html;
}

function incQty(id){ 
  let item = cart.find(c => c.id === id); 
  if(item){ 
    item.qtd++; 
    showCart(); 
  } 
}

function decQty(id){ 
  let item = cart.find(c => c.id === id); 
  if(item){ 
    item.qtd--; 
    if(item.qtd <= 0) {
      cart = cart.filter(x => x.id !== id);
    }
    showCart(); 
  } 
}

function clearCart(){ 
  if(confirm('Tem certeza que deseja limpar o carrinho?')){ 
    cart = []; 
    showCart(); 
  } 
}

// Fun√ß√£o para converter coordenadas em endere√ßo usando OpenStreetMap
async function getEnderecoFromCoords(lat, lng) {
  try {
    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=pt-BR`);
    const data = await response.json();
    
    if(data && data.address) {
      const addr = data.address;
      // Monta o endere√ßo com os dados dispon√≠veis
      let enderecoCompleto = '';
      if(addr.road) enderecoCompleto += addr.road;
      if(addr.suburb) enderecoCompleto += ', ' + addr.suburb;
      if(addr.city) enderecoCompleto += ', ' + addr.city;
      if(addr.state) enderecoCompleto += ' - ' + addr.state;
      
      return enderecoCompleto || `Localiza√ß√£o: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
    }
    return `Localiza√ß√£o: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
  } catch (error) {
    console.error('Erro ao buscar endere√ßo:', error);
    return `Localiza√ß√£o: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;
  }
}

function startCheckout(){
  if(cart.length === 0){ 
    alert('Carrinho vazio'); 
    return; 
  }
  
  // Tenta pegar localiza√ß√£o autom√°tica do GPS
  if(navigator.geolocation){
    if(confirm('Deseja usar sua localiza√ß√£o atual autom√°tica?\n\nO app vai detectar seu endere√ßo completo (rua, bairro, cidade).')){
      // Mostra loading
      document.getElementById('view').innerHTML = '<div class="loading">üìç Detectando sua localiza√ß√£o...</div>';
      
      navigator.geolocation.getCurrentPosition(
        async function(position){
          // Sucesso - pegou a localiza√ß√£o GPS
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          
          // Converte coordenadas em endere√ßo leg√≠vel
          const enderecoCompleto = await getEnderecoFromCoords(lat, lng);
          
          let descricao = prompt(`Endere√ßo detectado:\n${enderecoCompleto}\n\nDigite complemento ou ponto de refer√™ncia:`);
          if(descricao && descricao.length > 30) {
            descricao = descricao.substring(0, 30);
          }
          
          showUploadComprovante(enderecoCompleto, descricao);
        },
        function(error){
          // Erro ou usu√°rio negou GPS
          console.log('Erro GPS:', error);
          let localizacao = prompt('Localiza√ß√£o autom√°tica falhou. Digite seu endere√ßo completo:');
          if(!localizacao) return;
          
          let descricao = prompt('Complemento ou ponto de refer√™ncia:');
          if(descricao && descricao.length > 30) {
            descricao = descricao.substring(0, 30);
          }
          
          showUploadComprovante(localizacao, descricao);
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    } else {
      // Usu√°rio n√£o quis GPS - pede endere√ßo manual
      let localizacao = prompt('Digite seu endere√ßo completo (rua, n√∫mero, bairro, cidade):');
      if(!localizacao) return;
      
      let descricao = prompt('Complemento ou ponto de refer√™ncia:');
      if(descricao && descricao.length > 30) {
        descricao = descricao.substring(0, 30);
      }
      
      showUploadComprovante(localizacao, descricao);
    }
  } else {
    // Navegador n√£o suporta geolocaliza√ß√£o
    let localizacao = prompt('Digite seu endere√ßo completo (rua, n√∫mero, bairro, cidade):');
    if(!localizacao) return;
    
    let descricao = prompt('Complemento ou ponto de refer√™ncia:');
    if(descricao && descricao.length > 30) {
      descricao = descricao.substring(0, 30);
    }
    
    showUploadComprovante(localizacao, descricao);
  }
}

// Tela de upload do comprovante
function showUploadComprovante(localizacao, descricao) {
  currentView = 'checkout';
  let selectedFile = null;
  
  const html = `
    <div class="card">
      <h3>üìã Resumo do Pedido</h3>
      <p><strong>Endere√ßo:</strong> ${localizacao}</p>
      <p><strong>Complemento:</strong> ${descricao || 'Nenhum'}</p>
      <p><strong>Total:</strong> R$ ${cart.reduce((total, item) => total + (item.preco * item.qtd), 0).toFixed(2)}</p>
    </div>
    
    <div class="card">
      <h3>üìé Enviar Comprovante de Pagamento</h3>
      <p>Envie uma foto ou PDF do comprovante (m√°ximo 2 MB)</p>
      
      <div class="upload-area" id="uploadArea">
        <p>üìÅ Arraste o arquivo aqui ou clique para selecionar</p>
        <input type="file" id="fileInput" accept="image/*,.pdf" style="display: none">
        <button class="btn" onclick="document.getElementById('fileInput').click()">Selecionar Arquivo</button>
      </div>
      
      <div id="fileInfo"></div>
      
      <div style="margin-top: 15px;">
        <button class="btn" id="submitBtn" disabled onclick="finalizarPedidoComComprovante('${localizacao}', '${descricao}')">‚úÖ Finalizar Pedido</button>
        <button class="btn-ghost" onclick="showCart()">‚Üê Voltar</button>
      </div>
    </div>
  `;
  
  document.getElementById('view').innerHTML = html;
  
  const fileInput = document.getElementById('fileInput');
  const uploadArea = document.getElementById('uploadArea');
  const fileInfo = document.getElementById('fileInfo');
  const submitBtn = document.getElementById('submitBtn');
  
  // Drag and drop
  uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadArea.classList.add('active');
  });
  
  uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('active');
  });
  
  uploadArea.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadArea.classList.remove('active');
    if (e.dataTransfer.files.length) {
      handleFileSelect(e.dataTransfer.files[0]);
    }
  });
  
  fileInput.addEventListener('change', (e) => {
    if (e.target.files.length) {
      handleFileSelect(e.target.files[0]);
    }
  });
  
  function handleFileSelect(file) {
    // Verifica tamanho (2MB = 2 * 1024 * 1024)
    if (file.size > 2 * 1024 * 1024) {
      alert('‚ùå Arquivo muito grande! M√°ximo 2 MB permitido.');
      return;
    }
    
    // Verifica tipo
    if (!file.type.match('image.*') && !file.type.match('application/pdf')) {
      alert('‚ùå Formato n√£o permitido! Apenas imagens ou PDF.');
      return;
    }
    
    selectedFile = file;
    
    // Mostra info do arquivo
    const fileSize = (file.size / 1024 / 1024).toFixed(2);
    fileInfo.innerHTML = `
      <div class="file-info">
        <strong>üìÑ ${file.name}</strong><br>
        Tipo: ${file.type}<br>
        Tamanho: ${fileSize} MB<br>
        ‚úÖ Arquivo pronto para envio
      </div>
    `;
    
    // Ativa bot√£o de enviar
    submitBtn.disabled = false;
    submitBtn.classList.remove('btn-disabled');
  }
  
  // Expor a selectedFile globalmente para a fun√ß√£o finalizarPedidoComComprovante
  window.finalizarPedidoComComprovante = function(localizacao, descricao) {
    if (!selectedFile) {
      alert('‚ùå Selecione um arquivo de comprovante primeiro!');
      return;
    }
    
    // Converte arquivo para Base64
    const reader = new FileReader();
    reader.onload = function(e) {
      const comprovanteBase64 = e.target.result;
      
      let codigoPedido = Math.floor(Math.random() * 900 + 100);
      let totalPedido = cart.reduce((total, item) => total + (item.preco * item.qtd), 0);
      
      let pedido = {
        codigo: codigoPedido,
        produtos: [...cart],
        total: totalPedido,
        local: localizacao,
        desc: descricao || '',
        comprovante: comprovanteBase64,
        comprovanteNome: selectedFile.name,
        comprovanteTipo: selectedFile.type,
        data: new Date().toLocaleString('pt-BR'),
        status: 'Pedido recebido - Aguardando confirma√ß√£o do pagamento'
      };
      
      orders.push(pedido);
      notifications.push({
        codigo: codigoPedido,
        msg: `Pedido realizado - R$ ${totalPedido.toFixed(2)} - Comprovante enviado`,
        data: pedido.data
      });
      
      alert(`‚úÖ Pedido #${codigoPedido} confirmado!\nüí∞ Total: R$ ${totalPedido.toFixed(2)}\nüìç Entrega em: ${localizacao}\nüìé Comprovante enviado com sucesso!`);
      
      cart = [];
      showHome();
    };
    
    reader.onerror = function() {
      alert('‚ùå Erro ao ler o arquivo. Tente novamente.');
    };
    
    reader.readAsDataURL(selectedFile);
  };
}

function showNotifs(){
  currentView = 'notifs';
  let html = '<h3>Notifica√ß√µes</h3>';
  
  if(notifications.length === 0){ 
    html += '<p>Nenhuma notifica√ß√£o.</p>';
  } else {
    notifications.slice().reverse().forEach(notif => {
      html += `<div class='card'>
        <b>Pedido #${notif.codigo}</b>
        <div>${notif.msg}</div>
        <small>${notif.data}</small>
      </div>`;
    });
  }
  
  document.getElementById('view').innerHTML = html;
}

function showAdminOrders(){
  currentView = 'admin';
  let html = '<h3>Pedidos - √Årea Administrativa</h3>';
  
  if(orders.length === 0){ 
    html += '<p>Nenhum pedido realizado.</p>';
  } else {
    orders.slice().reverse().forEach(pedido => {
      const comprovanteHtml = pedido.comprovante ? 
        `<p><strong>Comprovante:</strong> 
          <a href="${pedido.comprovante}" target="_blank" download="comprovante_${pedido.codigo}.${pedido.comprovanteType === 'application/pdf' ? 'pdf' : 'jpg'}">
            üìé Ver Comprovante (${pedido.comprovanteNome})
          </a>
        </p>` : 
        '<p><strong>Comprovante:</strong> ‚ùå N√£o enviado</p>';
      
      html += `<div class='card'>
        <h4>Pedido #${pedido.codigo}</h4>
        <p><strong>Status:</strong> ${pedido.status}</p>
        <p><strong>Data:</strong> ${pedido.data}</p>
        <p><strong>Endere√ßo:</strong> ${pedido.local}</p>
        <p><strong>Total:</strong> R$ ${pedido.total.toFixed(2)}</p>
        ${comprovanteHtml}
        <p><strong>Itens:</strong> ${pedido.produtos.map(p => `${p.nome} (x${p.qtd})`).join(', ')}</p>
        <button class="btn" onclick='atualizarStatus(${pedido.codigo},"Pagamento confirmado - Preparando pedido")'>‚úÖ Confirmar Pagamento</button>
        <button class="btn" onclick='atualizarStatus(${pedido.codigo},"Pedido em rota de entrega")'>üöö Saiu para Entrega</button>
        <button class="btn" onclick='atualizarStatus(${pedido.codigo},"Pedido entregue")'>üéâ Entregue</button>
      </div>`;
    });
  }
  
  document.getElementById('view').innerHTML = html;
}

function atualizarStatus(codigo, novoStatus){
  let pedido = orders.find(o => o.codigo === codigo);
  if(pedido){
    pedido.status = novoStatus;
    
    // Atualiza notifica√ß√£o
    const notifIndex = notifications.findIndex(n => n.codigo === codigo);
    if(notifIndex !== -1) {
      notifications[notifIndex].msg = `Status atualizado: ${novoStatus}`;
    }
    
    alert(`‚úÖ Status do pedido #${codigo} atualizado para: ${novoStatus}`);
    showAdminOrders();
  }
}

// --- INICIALIZA√á√ÉO ---
window.showHome = showHome;
window.showCategories = showCategories;
window.showCart = showCart;
window.showNotifs = showNotifs;
window.addToCart = addToCart;
window.incQty = incQty;
window.decQty = decQty;
window.clearCart = clearCart;
window.startCheckout = startCheckout;
window.showAdminOrders = showAdminOrders;
window.atualizarStatus = atualizarStatus;
window.openContact = openContact;
window.openUser = openUser;
window.goBack = goBack;

showHome();
</script>

</body>
</html>
  
